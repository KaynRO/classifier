# Global configuration
global_wait_time = 30


# TrendMicro categories
trendmicro_website_categories = [
            "Adult / Mature Content",
            "Pornography",
            "Sex Education",
            "Intimate Apparel / Swimsuit",
            "Nudity",
            "Alcohol / Tobacco",
            "Illegal / Questionable",
            "Tasteless",
            "Gambling",
            "Violence / Hate / Racism",
            "Weapons",
            "Abortion",
            "Illegal Drugs",
            "Marijuana",
            "Business / Economy",
            "Financial Services",
            "Brokerages / Trading",
            "Job Search / Careers",
            "Shopping",
            "Auctions",
            "Real Estate",
            "Dynamic DNS",
            "Internet Telephony",
            "Proxy Avoidance and Anonymizers",
            "Search Engines / Portals",
            "Internet Infrastructure",
            "Blogs / Web Communications",
            "Social Networking",
            "Chat / Instant Messaging",
            "Email",
            "Newsgroups / Forum",
            "Coin Miners",
            "Web Hosting",
            "Education",
            "Government / Legal",
            "Military",
            "Politics",
            "Health",
            "Computers / Internet",
            "News / Media",
            "Translators / Cached Pages",
            "Reference",
            "Vehicles",
            "Spyware",
            "Phishing",
            "Spam",
            "Adware",
            "Malware Accomplice",
            "Disease Vector",
            "Made for AdSense",
            "Web Advertisements",
            "Scam",
            "Ransomware",
            "Recreation / Hobbies",
            "Arts",
            "Entertainment",
            "Cult / Occult",
            "Cultural Institutions",
            "Activist Groups",
            "Games",
            "Alternative Journals",
            "Personals / Dating",
            "Religion",
            "Personal Sites",
            "Society / Lifestyle",
            "Gun Clubs / Hunting",
            "Restaurants / Food",
            "Sports",
            "Travel",
            "Humor",
            "For Kids",
            "Internet Radio and TV",
            "Photo Searches",
            "Sharing Services",
            "Peer-to-peer",
            "Streaming Media / MP3",
            "Ringtones / Mobile Phone Downloads",
            "Software Downloads",
            "Pay to Surf"
        ]

# BlueCoat categories
bluecoat_website_categories = [
    "Abortion",
    "Adult/Mature Content",
    "Alcohol",
    "Alternative Spirituality/Belief",
    "Art/Culture",
    "Auctions",
    "Audio/Video Clips",
    "Brokerage/Trading",
    "Business/Economy",
    "Charitable/Non-Profit",
    "Chat (IM)/SMS",
    "Child Pornography",
    "Cloud Infrastructure",
    "Compromised Sites",
    "Computer/Information Security",
    "Content Delivery Networks",
    "Controlled Substances",
    "Cryptocurrency",
    "Dynamic DNS Host",
    "E-Card/Invitations",
    "Education",
    "Email",
    "Email Marketing",
    "Entertainment",
    "File Storage/Sharing",
    "Finance",
    "For Kids",
    "Gambling",
    "Games",
    "Gore/Extreme",
    "Government/Legal",
    "Hacking",
    "Health",
    "Humor/Jokes",
    "Internet Connected Devices",
    "Internet Telephony",
    "Intimate Apparel/Swimsuit",
    "Job Search/Careers",
    "Malicious Outbound Data/Botnets",
    "Malicious Sources/Malnets",
    "Marijuana",
    "Media Sharing",
    "Military",
    "Mixed Content/Potentially Adult",
    "News",
    "Newsgroups/Forums",
    "Nudity",
    "Office/Business Applications",
    "Online Meetings",
    "Peer-to-Peer (P2P)",
    "Personal Sites",
    "Personals/Dating",
    "Phishing",
    "Piracy/Copyright Concerns",
    "Placeholders",
    "Political/Social Advocacy",
    "Pornography",
    "Potentially Unwanted Software",
    "Restaurants/Food",
    "Scam/Questionable Legality",
    "Search Engines/Portals",
    "Sex Education",
    "Shopping",
    "Social Networking",
    "Society/Daily Living",
    "Software Downloads",
    "Spam",
    "Sports/Recreation",
    "Suspicious",
    "Technology/Internet",
    "Tobacco",
    "Translation",
    "Travel",
    "TV/Video Streams",
    "URL Shorteners",
    "Vehicles",
    "Violence/Intolerance",
    "Weapons",
    "Web Ads/Analytics",
    "Web Hosting",
    "Web Infrastructure"
]

# Palo Alto categories
palo_alto_website_categories = [
    "Abused Drugs",
    "Adult",
    "Alcohol and Tobacco",
    "Artificial Intelligence",
    "Auctions",
    "Business and Economy",
    "Command and Control",
    "Computer and Internet Info",
    "Content Delivery Networks",
    "Copyright Infringement",
    "Cryptocurrency",
    "Dating",
    "Dynamic DNS",
    "Educational Institutions",
    "Encrypted DNS",
    "Entertainment and Arts",
    "Extremism",
    "Financial Services",
    "Gambling",
    "Games",
    "Government",
    "Grayware",
    "Hacking",
    "Health and Medicine",
    "High Risk",
    "Home and Garden",
    "Hunting and Fishing",
    "Insufficient Content",
    "Internet Communications and Telephony",
    "Internet Portals",
    "Job Search",
    "Legal",
    "Low Risk",
    "Malware",
    "Medium Risk",
    "Military",
    "Motor Vehicles",
    "Music",
    "Newly Registered Domain",
    "News",
    "Nudity",
    "Online Storage and Backup",
    "Parked",
    "Peer-to-Peer",
    "Personal Sites and Blogs",
    "Philosophy and Political Advocacy",
    "Phishing",
    "Private IP Addresses",
    "Proxy Avoidance and Anonymizers",
    "Questionable",
    "Ransomware",
    "Real Estate",
    "Real-time Detection",
    "Recreation and Hobbies",
    "Reference and Research",
    "Religion",
    "Scanning Activity",
    "Search Engines",
    "Sex Education",
    "Shareware and Freeware",
    "Shopping",
    "Social Networking",
    "Society",
    "Sports",
    "Stock Advice and Tools",
    "Streaming Media",
    "Swimsuits and Intimate Apparel",
    "Training and Tools",
    "Translation",
    "Travel",
    "Unknown",
    "Weapons",
    "Web Advertisements",
    "Web Hosting",
    "Web-based Email"
]

# BrightCloud categories
brightcloud_website_categories = [
    "Abortion",
    "Government",
    "Motor Vehicles",
    "Search Engines",
    "Abused Drugs",
    "Gross",
    "Music",
    "Sex Education",
    "Adult and Pornography",
    "Hacking",
    "News and Media",
    "Shareware and Freeware",
    "Alcohol and Tobacco",
    "Hate and Racism",
    "Nudity",
    "Shopping",
    "Auctions",
    "Health and Medicine",
    "Online Greeting cards",
    "Social Network",
    "Bot Nets",
    "Home and Garden",
    "Parked Domains",
    "Society",
    "Business and Economy",
    "Hunting and Fishing",
    "Pay to Surf",
    "Sports",
    "CDNs",
    "Illegal",
    "Peer to Peer",
    "Spyware and Adware",
    "Cheating",
    "Image and Video Search",
    "Personal Storage",
    "Stock Advice and Tools",
    "Computer and Internet Info",
    "Internet Communications",
    "Personal sites and Blogs",
    "Streaming Media",
    "Computer and Internet Security",
    "Internet Portals",
    "Philosophy and Political Advocacy",
    "Swimsuits and Intimate Apparel",
    "Cult and Occult",
    "Job Search",
    "Phishing and Other Frauds",
    "Training and Tools",
    "Dating",
    "Keyloggers and Monitoring",
    "Proxy Avoid and Anonymizers",
    "Translation",
    "Educational Institutions",
    "Kids",
    "Questionable",
    "Travel",
    "Entertainment and Arts",
    "Legal",
    "Real Estate",
    "Violence",
    "Fashion and Beauty",
    "Local Information",
    "Recreation and Hobbies",
    "Weapons",
    "Financial Services",
    "Malware Sites",
    "Reference and Research",
    "Web Advertisements",
    "Gambling",
    "Marijuana",
    "Religion",
    "Web Hosting Sites",
    "Games",
    "Military",
    "SPAM URLs",
    "Web based email"
]

# McAfee categories
mcafee_website_categories = [
    "Alcohol",
    "Anonymizers",
    "Anonymizing Utilities",
    "Art/Culture/Heritage",
    "Auctions/Classifieds",
    "Blogs/Wiki",
    "Browser Exploits",
    "Business",
    "Chat",
    "Consumer Protection",
    "Content Server",
    "Controversial Opinions",
    "Dating/Personals",
    "Digital Postcards",
    "Discrimination",
    "Drugs",
    "Education/Reference",
    "Entertainment",
    "Extreme",
    "Fashion/Beauty",
    "Finance/Banking",
    "For Kids",
    "Forum/Bulletin Boards",
    "Gambling",
    "Gambling Related",
    "Game/Cartoon Violence",
    "Games",
    "General News",
    "Government/Military",
    "Gruesome Content",
    "Health",
    "Historical Revisionism",
    "Humor/Comics",
    "Incidental Nudity",
    "Information Security",
    "Instant Messaging",
    "Interactive Web Applications",
    "Internet Radio/TV",
    "Internet Services",
    "Job Search",
    "Major Global Religions",
    "Malicious Downloads",
    "Malicious Sites",
    "Marketing/Merchandising",
    "Media Downloads",
    "Media Sharing",
    "Messaging",
    "Mobile Phone",
    "Moderated",
    "Motor Vehicles",
    "Non-Profit/Advocacy/NGO",
    "Nudity",
    "Online Shopping",
    "P2P/File Sharing",
    "Parked Domain",
    "Personal Network Storage",
    "Personal Pages",
    "Pharmacy",
    "Phishing",
    "Politics/Opinion",
    "Pornography",
    "Portal Sites",
    "Potential Criminal Activities",
    "Potential Hacking/Computer Crime",
    "Potential Illegal Software",
    "Profanity",
    "Professional Networking",
    "Provocative Attire",
    "Public Information",
    "PUPs",
    "Real Estate",
    "Recreation/Hobbies",
    "Religion/Ideology",
    "Remote Access",
    "Residential IP Addresses",
    "Resource Sharing",
    "Restaurants",
    "School Cheating Information",
    "Search Engines",
    "Sexual Materials",
    "Shareware/Freeware",
    "Social Networking",
    "Software/Hardware",
    "Spam URLs",
    "Sports",
    "Spyware/Adware/Keyloggers",
    "Stock Trading",
    "Streaming Media",
    "Technical Information",
    "Technical/Business Forums",
    "Text Translators",
    "Text/Spoken Only",
    "Tobacco",
    "Travel",
    "Usenet News",
    "Violence",
    "Visual Search Engines",
    "Weapons",
    "Web Ads",
    "Web Mail",
    "Web Meetings",
    "Web Phone"
]

# Talos Intelligence categories
talos_intelligence_website_categories = ['Unknown', 'Adult', 'Advertisements', 'Alcohol', 'Animals and Pets', 'Arts', 'Astrology', 'Auctions', 'Business and Industry', 'Cannabis', 'Chat and Instant Messaging', 'Cheating and Plagiarism', 'Child Abuse Content', 'Cloud and Data Centers', 'Computer Security', 'Computers and Internet', 'Conventions, Conferences and Trade Shows', 'Cryptocurrency', 'Cryptomining', 'DIY Projects', 'DNS-Tunneling', 'Dating', 'Digital Postcards', 'Dining and Drinking', 'DoH and DoT', 'Dynamic DNS Provider', 'Dynamic and Residential', 'Education', 'Entertainment', 'Extreme', 'Fashion', 'File Transfer Services', 'Filter Avoidance', 'Finance', 'Freeware and Shareware', 'Gambling', 'Games', 'Government and Law', 'Hacking', 'Hate Speech', 'Health and Medicine', 'Humor', 'Hunting', 'Illegal Activities', 'Illegal Downloads', 'Illegal Drugs', 'Infrastructure and Content Delivery Networks', 'Internet Telephony', 'Internet of Things', 'Job Search', 'Lingerie and Swimsuits', 'Lotteries', 'Military', 'Mobile Phones', 'Museums', 'Nature and Conservation', 'News', 'Non-governmental Organizations', 'Non-sexual Nudity', 'Online Communities', 'Online Document Sharing and Collaboration', 'Online Meetings', 'Online Storage and Backup', 'Online Trading', 'Organizational Email', 'Paranormal', 'Parked Domains', 'Peer File Transfer', 'Personal Sites', 'Personal VPN', 'Photo Search and Images', 'Politics', 'Pornography', 'Private IP Addresses as Host', 'Professional Networking', 'Real Estate', 'Recipes and Food', 'Reference', 'Regional Restricted Sites (Germany)', 'Regional Restricted Sites (Great Britain)', 'Regional Restricted Sites (Italy)', 'Regional Restricted Sites (Poland)', 'Religion', 'SaaS and B2B', 'Safe for Kids', 'Science and Technology', 'Search Engines and Portals', 'Sex Education', 'Shopping', 'Social Networking', 'Social Science', 'Society and Culture', 'Software Updates', 'Sports and Recreation', 'Streaming Audio', 'Streaming Video', 'Terrorism and Violent Extremism', 'Tobacco', 'Transportation', 'Travel', 'URL Shorteners', 'Weapons', 'Web Cache and Archives', 'Web Hosting', 'Web Page Translation', 'Web-based Email']

available_categories = ["Business", "Education", "Finance", "Health", "News", "Internet"]

categories_map = {
    "Business": {
        "Bluecoat": "Business/Economy",
        "PaloAlto": "Business and Economy",
        "TrendMicro": "Business / Economy",
        "BrightCloud": "Business and Economy",
        "McAfee": "Business",
        "Talos": "Business and Industry",
        "Zvelo": "Business"
    },
    "Education": {
        "Bluecoat": "Education",
        "PaloAlto": "Educational Institutions",
        "TrendMicro": "Education",
        "BrightCloud": "Educational Institutions",
        "McAfee": "Education/Reference",
        "Talos": "Education",
        "Zvelo": "Education"
    },
    "Health": {
        "Bluecoat": "Health",
        "PaloAlto": "Health and Medicine",
        "TrendMicro": "Health",
        "BrightCloud": "Health and Medicine",
        "McAfee": "Health",
        "Talos": "Health and Medicine",
        "Zvelo": "Health"
    },
    "News": {
        "Bluecoat": "News",
        "PaloAlto": "News",
        "TrendMicro": "News / Media",
        "BrightCloud": "News and Media",
        "McAfee": "General News",
        "Talos": "News",
        "Zvelo": "News"
    },
    "Finance": {
        "Bluecoat": "Finance",
        "PaloAlto": "Financial Services",
        "TrendMicro": "Financial Services",
        "BrightCloud": "Financial Services",
        "McAfee": "Finance",
        "Talos": "Finance",
        "Zvelo": "Finance"
    },
    "Internet": {
        "Bluecoat": "Technology/Internet",
        "PaloAlto": "Computer and Internet Info",
        "TrendMicro": "Computers / Internet",
        "BrightCloud": "Computer and Internet Info",
        "McAfee": "Internet Services",
        "Talos": "Computers and Internet",
        "Zvelo": "Technology"
    }
}

CAPTCHA_PATTERNS = {
    "recaptcha_v2": {
        "iframe_selectors": [
            "iframe[src*='google.com/recaptcha']",
            "iframe[src*='recaptcha/api2']",
            "iframe[title*='reCAPTCHA']",
        ],
        "div_selectors": [
            "div.g-recaptcha",
            "div[data-sitekey]",
            "div#g-recaptcha",
        ],
        "script_patterns": [
            r'google\.com/recaptcha',
            r'grecaptcha',
        ]
    },
    "recaptcha_v3": {
        "script_patterns": [
            r'recaptcha/api\.js\?render=',
            r'grecaptcha\.execute',
        ],
        "badge_selectors": [
            "div.grecaptcha-badge",
        ]
    },
    "recaptcha_enterprise": {
        "script_patterns": [
            r'recaptcha/enterprise\.js',
            r'enterprise\.js\?render=',
        ],
        "div_selectors": [
            "div[data-sitekey][data-size='invisible']",
        ]
    },
    "turnstile": {
        "iframe_selectors": [
            "iframe[src*='challenges.cloudflare.com']",
            "iframe[src*='turnstile']",
        ],
        "div_selectors": [
            "div.cf-turnstile",
            "div[data-sitekey][class*='turnstile']",
        ],
        "script_patterns": [
            r'challenges\.cloudflare\.com/turnstile',
            r'turnstile/v0/api\.js',
        ],
        "input_selectors": [
            "input[name='cf-turnstile-response']",
        ]
    },
    "cloudflare_challenge": {
        "meta_selectors": [
            "meta[http-equiv='refresh'][content*='URL=/cdn-cgi/']",
        ],
        "title_patterns": [
            r'just a moment',
            r'attention required',
            r'checking your browser',
        ],
        "ray_id_selectors": [
            "span.ray-id",
            "span[data-ray-id]",
        ]
    },
}


# CAPTCHA checkbox, verified, and challenge selectors
CAPTCHA_SELECTORS = {
    "checkbox": {
        "recaptcha_v2": ['iframe[src*="recaptcha"][src*="anchor"]', '.recaptcha-checkbox-border', '#recaptcha-anchor'],
        "turnstile": [
            '.cf-turnstile iframe',
            'iframe[src*="challenges.cloudflare.com/turnstile"]',
            '#turnstile-wrapper iframe',
            '[id*="turnstile"] iframe',
            'div[data-sitekey] iframe',
            '.cf-turnstile',
            '#cf-turnstile',
            '[id*="turnstile"]',
        ],
    },
    "verified": {
        "recaptcha_v2": ['.recaptcha-checkbox-checked', '[aria-checked="true"]'],
        "turnstile": ['input[name="cf-turnstile-response"][value]:not([value=""])'],
    },
    "challenge": {
        "recaptcha_v2": ['iframe[src*="recaptcha"][src*="bframe"]', '.rc-imageselect', 'img.rc-image-tile-wrapper'],
    },
}


# JavaScript injection snippets for setting CAPTCHA tokens
INJECT_JS = {
    "recaptcha_v2": '''
        var token = arguments[0];
        var ta = document.getElementById('g-recaptcha-response');
        if (ta) { ta.innerHTML = token; ta.value = token; }
        document.querySelectorAll('[name="g-recaptcha-response"]').forEach(function(t) { t.innerHTML = token; t.value = token; });
        if (typeof ___grecaptcha_cfg !== 'undefined' && ___grecaptcha_cfg.clients) {
            for (var k in ___grecaptcha_cfg.clients) { var c = ___grecaptcha_cfg.clients[k]; if (c && c.callback) c.callback(token); }
        }
    ''',
    "recaptcha_v3": '''
        var token = arguments[0];
        document.querySelectorAll('input[name="g-recaptcha-response"]').forEach(function(i) { i.value = token; });
        document.querySelectorAll('input[type="hidden"]').forEach(function(i) { if (i.name && i.name.toLowerCase().indexOf('recaptcha') >= 0) i.value = token; });
    ''',
    "recaptcha_enterprise": '''
        var token = arguments[0];
        var ta = document.getElementById('g-recaptcha-response');
        if (ta) { ta.innerHTML = token; ta.value = token; }
        document.querySelectorAll('[name="g-recaptcha-response"]').forEach(function(t) { t.innerHTML = token; t.value = token; });
        document.querySelectorAll('input[type="hidden"]').forEach(function(i) { if (i.name && i.name.toLowerCase().indexOf('recaptcha') >= 0) i.value = token; });
    ''',
    "turnstile": '''
        var token = arguments[0];
        document.querySelectorAll('input[name="cf-turnstile-response"]').forEach(function(i) { i.value = token; });
        document.querySelectorAll('.cf-turnstile input[type="hidden"]').forEach(function(i) { i.value = token; });
    ''',
}


# JavaScript detection snippets for extracting CAPTCHA sitekeys
DETECT_JS = {
    "recaptcha_v2": '''return (function() {
        var g = document.querySelector('.g-recaptcha[data-sitekey]');
        if (g) return { sitekey: g.getAttribute('data-sitekey'), callback: g.getAttribute('data-callback'), invisible: g.getAttribute('data-size') === 'invisible' };
        var d = document.querySelector('div[data-sitekey]:not(.cf-turnstile):not(.h-captcha)');
        if (d) return { sitekey: d.getAttribute('data-sitekey'), callback: d.getAttribute('data-callback'), invisible: d.getAttribute('data-size') === 'invisible' };
        var scripts = document.querySelectorAll('script');
        for (var i = 0; i < scripts.length; i++) {
            var s = scripts[i];
            if (s.textContent && s.textContent.indexOf('grecaptcha.render') >= 0) {
                var m = s.textContent.match(/sitekey['"]?\\s*:\\s*['"]([a-zA-Z0-9_-]{30,})['"]/);
                if (m) return { sitekey: m[1], invisible: !!s.textContent.match(/size['"]?\\s*:\\s*['"]invisible['"]/) };
            }
        }
        return null;
    })()''',

    "recaptcha_v3_sitekey": '''return (function() {
        var scripts = document.querySelectorAll('script[src*="recaptcha"]');
        for (var i = 0; i < scripts.length; i++) {
            var m = scripts[i].src.match(/render=([^&]+)/);
            if (m && m[1] !== 'explicit' && m[1].length >= 30) return m[1];
        }
        return null;
    })()''',

    "recaptcha_enterprise": '''return (function() {
        var es = document.querySelector('script[src*="enterprise.js"], script[src*="recaptcha/enterprise"]');
        if (!es) return null;
        var sitekey = null, isV3 = false;
        var sm = es.src.match(/render=([^&]+)/);
        if (sm && sm[1] !== 'explicit' && sm[1].length >= 30) { sitekey = sm[1]; isV3 = true; }
        if (!sitekey) { var g = document.querySelector('.g-recaptcha[data-sitekey]'); if (g) { sitekey = g.getAttribute('data-sitekey'); isV3 = g.getAttribute('data-size') === 'invisible'; } }
        if (!sitekey) { var scripts = document.querySelectorAll('script'); for (var i = 0; i < scripts.length; i++) { if (scripts[i].textContent) { var m = scripts[i].textContent.match(/sitekey['"]?\\s*:\\s*['"]([a-zA-Z0-9_-]{30,})['"]/); if (m) { sitekey = m[1]; break; } } } }
        if (!sitekey) return null;
        var action = null;
        var allScripts = document.querySelectorAll('script');
        for (var i = 0; i < allScripts.length; i++) {
            if (allScripts[i].textContent && allScripts[i].textContent.indexOf('grecaptcha') >= 0) {
                var em = allScripts[i].textContent.match(/grecaptcha\\.enterprise\\.execute\\([^,]+,\\s*\\{[^}]*action\\s*:\\s*['"]([a-zA-Z0-9_]+)['"]/);
                if (em) { action = em[1]; break; }
                var am = allScripts[i].textContent.match(/action\\s*:\\s*['"]([a-zA-Z0-9_]+)['"]/);
                if (am && am[1].length < 30) { action = am[1]; break; }
            }
        }
        return { sitekey: sitekey, isV3: isV3, action: action || 'verify' };
    })()''',

    "turnstile": '''return (function() {
        var cf = document.querySelector('.cf-turnstile');
        if (cf) return { sitekey: cf.getAttribute('data-sitekey'), callback: cf.getAttribute('data-callback'), action: cf.getAttribute('data-action'), cdata: cf.getAttribute('data-cdata') };
        var elements = document.querySelectorAll('[data-sitekey]');
        for (var i = 0; i < elements.length; i++) {
            var el = elements[i];
            var key = el.getAttribute('data-sitekey');
            if (key && key.length > 20) {
                if ((el.className && el.className.indexOf('turnstile') >= 0) || (el.id && el.id.indexOf('turnstile') >= 0) ||
                    el.querySelector('iframe[src*="challenges.cloudflare.com"]') ||
                    el.closest('[class*="turnstile"]') || el.closest('[id*="turnstile"]')) {
                    return { sitekey: key, callback: el.getAttribute('data-callback') };
                }
            }
        }
        var iframes = document.querySelectorAll('iframe[src*="challenges.cloudflare.com"], iframe[src*="turnstile"]');
        for (var i = 0; i < iframes.length; i++) {
            var src = iframes[i].src || '';
            var match = src.match(/[?&]k=([^&]+)/);
            if (match) return { sitekey: match[1] };
            var parent = iframes[i].closest('[data-sitekey]');
            if (parent) return { sitekey: parent.getAttribute('data-sitekey') };
        }
        var ts = document.querySelector('script[src*="challenges.cloudflare.com/turnstile"]');
        if (ts) { var e = document.querySelector('[data-sitekey]'); if (e) return { sitekey: e.getAttribute('data-sitekey') }; }
        var ti = document.querySelector('input[name="cf-turnstile-response"]');
        if (ti) { var p = ti.closest('[data-sitekey]'); if (p) return { sitekey: p.getAttribute('data-sitekey') }; }
        return null;
    })()''',

    "token_check": '''return (function() {
        var r = document.querySelector('#g-recaptcha-response, [name="g-recaptcha-response"]');
        if (r && r.value && r.value.length > 20) return 'recaptcha';
        var t = document.querySelector('[name="cf-turnstile-response"]');
        if (t && t.value && t.value.length > 20) return 'turnstile';
        return null;
    })()''',
}

